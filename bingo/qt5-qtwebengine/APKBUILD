# Maintainer: Denis Ryabyy <vv1r0x@gmail.com>
pkgname=qt5-qtwebengine
pkgver=5.8.0
pkgrel=0
pkgdesc="Qt5 - QtWebEngine components"
url="http://qt-project.org/"
arch="all"
license="LGPLv2 with exceptions or GPLv3 with exceptions"
depends=""
depends_dev="
	qt5-qtbase-dev
	qt5-qtwebchannel-dev
	qt5-qtdeclarative-dev
	alsa-lib-dev
	harfbuzz-dev
	zlib-dev
	libwebp-dev
	libxml2-dev
	libevent-dev
	jsoncpp-dev
	opus-dev
	protobuf-dev
	libsrtp-dev
	snappy-dev
	nss-dev
	libxslt-dev
	minizip-dev
	libxcomposite-dev
	libxcursor-dev
	libxi-dev
	libxrandr-dev
	libxscrnsaver-dev
	libxtst-dev
	pciutils-dev
	jpeg-dev	
        libpng-dev
	cairo-dev
	cups-dev
	mesa-dev
	libcap-dev
	freetype-dev
	hunspell-dev
	libxinerama-dev
	ffmpeg-dev
	nss-dev
	libwebp-dev
	bzip2-dev
	libvpx-dev
	sqlite-dev
	libelf-dev
	libgcrypt-dev
	gnutls-dev
	libxcursor-dev
	libxcomposite-dev
	libxrandr-dev
	libxscrnsaver-dev
	pciutils-dev
	eudev-dev
	libexif-dev
	hwdata-usb
	ninja
	libbsd-dev
	harfbuzz-dev
	snappy-dev
	bsd-compat-headers
	openssl-dev
	libre2-dev
	jsoncpp-dev
	minizip-dev
	linux-headers
"

makedepends="$depends_dev
	re2c
	yasm
	gperf
	bison
	perl
	python
	bash
	paxmark
	findutils
	gzip
"

subpackages="$pkgname-dev"

_ver=${pkgver/_/-}
_ver=${_ver/beta0/beta}
_ver=${_ver/rc0/rc}
_V=${_ver/rc/RC}
case $pkgver in
*_beta*|*_rc*) _rel=development_releases;;
*) _rel=official_releases;;
esac

source="https://download.qt.io/official_releases/qt/${_V%.*}/$_V/submodules/qtwebengine-opensource-src-$_V.tar.xz
chromium-system-jinja-r7.patch
chromium-widevine.patch
musl-fixes.patch
no-execinfo.patch
no-mallinfo.patch
resolver.patch
unset-madv_free.patch
chromium-config.patch
"

builddir="$srcdir"/qtwebengine-opensource-src-$_V

build() {
	cd "$builddir"
	qmake-qt5 || return 1
	make || return 1
}

package() {
	cd "$builddir"
	make install INSTALL_ROOT="$pkgdir" || return 1
	# remove rpath
#	chrpath --delete "$pkgdir"/usr/lib/qt5/libexec/* || return 1
	sed -i -e 's:-L/home[^ ]\+::g' "$pkgdir"/usr/lib/pkgconfig/*.pc
}
md5sums="6e7fb2be161c6db4d988a4f5b329672f  qtwebengine-opensource-src-5.8.0.tar.xz
f61d1c5d09f6a7f42f6c4918a766fa78  chromium-system-jinja-r7.patch
3c667a35914c5fdd193b0189c075fa9f  chromium-widevine.patch
57a7c8fb93705692b6c59a1a42e4b160  musl-fixes.patch
be79acc593a3757fe59bcef6a89b6fa7  no-execinfo.patch
65d00028e6f9b7ac078f29b69fbd9480  no-mallinfo.patch
13e825ce0ad2c0857e624932c3fdd297  resolver.patch
2d6fa8c8b5a5c19f96a411522d936648  unset-madv_free.patch
923dd05ce1bedb7ea9841aab8dfd9ae2  chromium-config.patch"
sha256sums="223d22f1660811e60677afe0a85f2f385823e25157689561489700c5d1da79be  qtwebengine-opensource-src-5.8.0.tar.xz
c44baeddf3d54a58059d85c3784a19af774a0f5f6a89db8eab2685a5db75d117  chromium-system-jinja-r7.patch
b417b9f6e8bace8bd9c692408a7394658999809501a6cae30f5f8f46883e8cbe  chromium-widevine.patch
d7f58beb88724f4948f9c23c7148ba1d4af33307d07c4c603e268dd0ba162bc1  musl-fixes.patch
a8f92cfdf9774b3f15c311b49d29b16472383f38b9571b1b30c950700060953b  no-execinfo.patch
e7457b9872b4a67520934a9cfabe82653fc36f651db3a2a78df720e05c40f9d8  no-mallinfo.patch
e35d957d0cc56c213f8f24e42633aa3f914d9f44983ac6b0d909af6eb5a9caad  resolver.patch
3aee32ca9b821e5ac7532cef7697b54f340a0340ab0130e3b29d1e42abc25efe  unset-madv_free.patch
0849ba5aaedf95c813834b3ce1dd553b8d978f1317b2d1f820a8cf6fcc105ad9  chromium-config.patch"
sha512sums="65124fb9a6d8baaec72c1e456e34a6dc9280f44eca502fef429b44072c8f0fed4c445d50ea48e8b569a8eb99d493aff1c60ca1b16ee0c3feba0674f999f541a1  qtwebengine-opensource-src-5.8.0.tar.xz
0d25ac4cb507a3936a81e0853832562e7c6decb2a689c07c3847a741824e8e266e70b9c82ef4d75d369dcb051e5ab0ff7a66ec3df43d534bb408422da4279428  chromium-system-jinja-r7.patch
f583362b582ff40e7c6156ebc5dcb2074ca837775f95d5614ff84c6f353810e42e5c3e79b7d2eba65dc85172dc7fe17dfb545f5f6fbf3a7e73cb01390cf4f55b  chromium-widevine.patch
84c376ccfbe205cbd57901119add94c8b70edac2ffae0cf89f074779d1e767be105a0256749bae38f4c5d2b362978ddfa74e6229b296f04a643f740f69830255  musl-fixes.patch
65326fdf11fff380b56af6dcb6c707c322089c31557f3f4fbcc902dbd14f3fe976243416d56d6264d5c65c64a492375f6da657eadba00c2903c3d6fbd2a9551b  no-execinfo.patch
3ec3670a68c1a81334a77d961d3a10fda01752470f15dc0df02a0af4715d008dc80bb1f5bd798dc7057041b1f0041ecfda10c48933b9ff3627f186016031c6d2  no-mallinfo.patch
35a31cca2a56648eb6f9ace6d749de78ed3c731872b36bd42a5a5fcab820a76f288c9fc945dc40c2250f80f85d0f6bbbe773f0716b0f3482560708bd12ae8f23  resolver.patch
0e22e61ba7a2b737650fbd899690d129130922142f0168e5eaa1d4463083fa08b9ffca7f8b3253a7bf9e7daee8c61e29b065408c0a3de179653e0f3756ef77c1  unset-madv_free.patch
8e9964de97f71fdf85f5d76f176457b1983eb3e53322508aaec31ebb9dd4c6112bebb44bed48e568967a463805e09c7bf6eda334aa6a1ed8aa9eca1ff661c7f0  chromium-config.patch"
